<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />

		<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
		Remove this if you use the .htaccess -->
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

		<title>index</title>
		<meta name="description" content="" />
		<meta name="author" content="Robert Stein" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
		<link rel="shortcut icon" href="/favicon.ico" />
		<link rel="apple-touch-icon" href="/apple-touch-icon.png" />
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<style>
			html, body, p, table, div {
				margin: 0px;
				padding: 0px;
				border: 0px;
			}

			.image {
				margin: 10px;
			}

			span.rollover_w {
				opacity: 1;
				-o-transition-duration: 1s;
				-moz-transition-duration: 1s;
				-webkit-transition: -webkit-transform 1s;
				background: center center no-repeat #FFF;
				cursor: pointer;
				width: 240px;
				position: absolute;
				z-index: 10;
				opacity: 0;
				-webkit-transition: opacity 0.25s ease;
			}

			span.cat {
				opacity: 1;
				-o-transition-duration: 1s;
				-moz-transition-duration: 1s;
				-webkit-transition: -webkit-transform 1s;
				background: center center no-repeat #FFF;
				cursor: pointer;
				height: 160px;
				width: 240px;
				position: absolute;
				z-index: 10;
				opacity: 1;
			}

			span.rollover_h:hover, span.rollover_w:hover {
				opacity: .89;
				-o-transition-duration: .25s;
				-moz-transition-duration: .25s;
				-webkit-transition: -webkit-transform .25s;
				-webkit-box-shadow: 0px 0px 0px #000;
				-moz-box-shadow: 0px 0px 0px #000;
				box-shadow: 0px 0px 0px #000;
				-webkit-transition: opacity .25s ease-in;
			}

			#back, #prev, #next {
				-o-transition-duration: .25s;
				-moz-transition-duration: .25s;
				-webkit-transition: -webkit-transform .25s;
				width: 50px;
				height: 50px;
				-webkit-border-radius: 25px;
				-moz-border-radius: 25px;
				background-color: #000;
				border-radius: 25px;
				border: 1px solid #000;
				opacity: 0;
				position: absolute;
				-webkit-transition: opacity .25s ease-in;
				background-repeat: no-repeat;
				background-position-x: 12px;
				background-position-y: 13px;
			}
			#back:hover, #prev:hover, #next:hover {
				-o-transition-duration: .25s;
				-moz-transition-duration: .25s;
				-webkit-transition: -webkit-transform .25s;
				opacity: 0.7;
				-webkit-transition: opacity .25s ease-in;
			}

			#line {
				-moz-transform: rotate(45deg);
				-o-transform: rotate(45deg);
				-webkit-transform: rotate(45deg);
				-ms-transform: rotate(45deg);
				transform: rotate(45deg);
				filter: progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',
				M11=0.9914448613738104, M12=-0.13052619222005157,M21=0.13052619222005157, M22=0.9914448613738104);
				-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.9914448613738104, M12=-0.13052619222005157, M21=0.13052619222005157, M22=0.9914448613738104,sizingMethod='auto expand')";
				zoom: 1;
				opacity: 1;
			}

			#line2 {
				-moz-transform: rotate(135deg);
				-o-transform: rotate(135deg);
				-webkit-transform: rotate(135deg);
				-ms-transform: rotate(135deg);
				transform: rotate(135deg);
				filter: progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand',
				M11=0.9914448613738104, M12=-0.13052619222005157,M21=0.13052619222005157, M22=0.9914448613738104);
				-ms-filter: "progid:DXImageTransform.Microsoft.Matrix(M11=0.9914448613738104, M12=-0.13052619222005157, M21=0.13052619222005157, M22=0.9914448613738104,sizingMethod='auto expand')";
				zoom: 1;
				opacity: 1;
			}

		</style>

	</head>

	<body>
		<div style="width:100%;" id="masterwrapper">
			<div style="position: relative; width: 100%; float:left;" id="wrapper">

			</div>

		</div>
		<script>
			var dict = [];
			var cols = Math.floor($(window).width()/256);
			var rightwrapper = $(document.createElement('div'));
			var back_button = $(document.createElement('div'));

			var next_button = $(document.createElement('div'));
			var next_arrow = $(document.createElement('div'));
			var prev_button = $(document.createElement('div'));
			var prev_arrow = $(document.createElement('div'));

			var left_line = $(document.createElement('div'));
			var right_line = $(document.createElement('div'));
			rightwrapper.attr({
				id : 'rightwrapper',
			});
			
			var resize = function resize () {
				if(Math.floor($(window).width()/256) != cols) {
					
					
					if($('#rightwrapper').length == 0) {
							console.log(cols);
				cols = Math.floor($(window).width()/256);
				$('#wrapper').empty();
				printCategory();
					}
					else {
						
					}
					

				}
			}
			
			$(window).resize(resize);
			
			rightwrapper.css('width', '50%');
			rightwrapper.css('float', 'right');
			rightwrapper.css('text-align', 'center');

			back_button.attr({
				id : 'back',
				style : "top: 50px; right: 80px; z-index: 10000;",
			});

			next_button.attr({
				id : 'prev',
				style : "top: 50px; right: 150px; background-image: url(img/next.png); z-index: 10000;",
			});

			prev_button.attr({
				id : 'next',
				style : "top: 50px; right: 220px; background-image: url(img/prev.png); z-index: 10000;",
			});

			back_button.append(left_line);
			back_button.append(right_line);

			left_line.attr({
				style : 'border-top: 3px solid #FFF; opacity: 1; margin-top: 20px; height: 30px; width: 30px;',
				class : 'line',
				id : 'line',
			});

			right_line.attr({
				style : 'border-top: 3px solid #FFF; opacity: 1; margin-top: -54px; height: 30px; width: 30px;',
				class : 'line2',
				id : 'line2',

			});
			//
			// var img1 = {
			// path_thumb : "img/DSC_0093_01.png",
			// path : "img/DSC_0093_01_big.png",
			// height : 361,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			// var img2 = {
			// path_thumb : "img/DSC_0048.png",
			// path : "img/DSC_0048_big.png",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			// var img3 = {
			// path_thumb : "img/notbusiness1.jpg",
			// path : "img/notbusiness1_big.jpg",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img4 = {
			// path_thumb : "img/DSC_0301.png",
			// path : "img/DSC_0301_big.jpg",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img5 = {
			// path_thumb : "img/DSC_0139.png",
			// path : "img/DSC_0139_big.png",
			// height : 361,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img6 = {
			// path_thumb : "img/DSC_0254.png",
			// path : "img/DSC_0254_big.png",
			// height : 361,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img7 = {
			// path_thumb : "img/DSC_0125.jpg",
			// path : "img/DSC_0125_big.jpg",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img8 = {
			// path_thumb : "img/DSC_0163.jpg",
			// path : "img/DSC_0163_big.jpg",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img9 = {
			// path_thumb : "img/DSC_0221.jpg",
			// path : "img/DSC_0221_big.jpg",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };
			//
			// var img10 = {
			// path_thumb : "img/DSC_0221.jpg",
			// path : "img/DSC_0221_big.jpg",
			// height : 160,
			// width : 240,
			// title : "SCHILLE PHOTOGRAPHY",
			// model : "roddirockz",
			// };

			// dict.push(img1);
			// dict.push(img2);
			// dict.push(img3);
			// dict.push(img4);
			// dict.push(img9);

			// dict.push(img8);
			// dict.push(img6);
			// dict.push(img7);
			// dict.push(img5);
			// dict.push(img10);
			// dict.push(img10);
			// dict.push(img10);
			
			var jqxhr = $.ajax("api.php?rpc=picdir").always(function(msg) {

				for (var key in msg) {
					dict.push(msg[key]);
				}
				printCategory();

			});

			function printCategory() {
				var pos = []
				for (var o = 0; o < cols; o++) {
					pos[o] = 20;
				}
				var current = 0;
				//start tile
				var m = $(document.createElement('div'));
				m.attr({
					class : "image",
					style : "position: absolute; top:" + pos[0] + "px;left:50%; margin-left:" + (-(124 * cols) + 0) + "px; background-color: #555; width: 240px; height: 160px;",
				});
				var k = $(document.createElement('span'));
				k.attr({
					class : "cat",
					style : "display: inline-block; text-align: center; background-color: #555;",
				});
				var n = $(document.createElement('span'));
				n.attr({
					style : "font-family: Arial, Helvetica, sans-serif;color: #CCC;  position: relative;  top: 25%; font-size: 14px; line-height: 18px; color: #CCC; padding: 5px; text-align: center; display: inline-block;",
				});

				m.append(k);

				n.html("<h2 style='border: 1px solid #CCC; padding: 8px; color: #CCC; font-size: 14px; line-height: 18px;'>SCHILLE CATEGORY</h2><p style='color: #CCC'>UNDERTITLE </p>")
				k.append(n);

				$("#wrapper").append(m);
				pos[0] = pos[0] + 160 + 10;

				var next = 0;
				jQuery.each(dict, function(i, val) {

					//for (var i = 0; i < dict.length; i++) {

					var m = $(document.createElement('div'));
					m.attr({
						class : "image",
						id : "img" + i,
						style : "position: absolute; top:" + pos[next % cols] + "px;left:50%; margin-left:" + (-(124 * cols) + (next % cols) * 250) + "px;",
					});
					var k = $(document.createElement('span'));

					k.attr({
						class : "rollover_w",
						style : "display: inline-block; text-align: center; height:" + val.height + "px;",
					});
					var n = $(document.createElement('span'));
					n.attr({
						style : "font-family: Arial, Helvetica, sans-serif;color: #555;  position: relative;  top: 25%; font-size: 14px; line-height: 18px; color: black; padding: 5px; text-align: center; display: inline-block;",
					});

					m.click(function move() {
						rightwrapper.append(back_button);
						if (i!= dict.length-1)
						rightwrapper.append(next_button);
						if (i != 0)
						rightwrapper.append(prev_button);

						next_button.click(function() {
							
							console.log("current is " + current);
							if (current == 0) {
							prev_button.css('display', 'block');
							rightwrapper.append(prev_button);
							}
							
							if (current == dict.length-2)
							next_button.css('display', 'none');
							
							
							
							var img_n1 = $(document.createElement('img'));
						img_n1.attr({
							src : dict[current+1].path,
							class : "bild",
							id : "bigpicture"+(current+1),
							
							style : "width: 100%; height: auto; display: none; left: 0px; top: 0px; position: absolute;",
						});

						var img_n2 = $(document.createElement('img'));
						img_n2.attr({
							src : dict[current+1].path_thumb,
							class : "bild",
							id : "bigpicture_thumb"+(current+1),
							

							style : "width: 100%; height: auto; display: inline-block; left: "+$(window).width()+"px; top: 0px; position: absolute;",
						});
						
						$(rightwrapper).append(img_n2);
						$(rightwrapper).append(img_n1);

							
							$(img_n1).one('load', function() {
							$(img_n2).animate({
								left : "0px",
							}, 500, function() {
								
								$(img_n2).css('display', 'none');
								$(img_n1).css('display', 'inline-block');
								console.log("removing #bigpicture"+(current)+"");
								$("#bigpicture"+(current-1)+"").remove();
								$("#bigpicture_thumb"+(current-1)+"").remove();
							});
							current++;
							
						}).each(function() {
							if (this.complete)
								$(this).load();
						});
							
							
						// $('#rightwrapper').animate({
							// marginRight: +$(window).width()+"px",
						// });
						
							
						});
						prev_button.click(function() {
							
							console.log("current is " + current);
							if (current == dict.length-1) {
								rightwrapper.append(next_button);
							next_button.css('display','block');
							}
							if (current == 1)
							prev_button.css('display','none');
							if(current == 0) 
							prev_button.css('display', 'none');
							
							var img_n1 = $(document.createElement('img'));
						img_n1.attr({
							src : dict[current-1].path,
							class : "bild",
							id : "bigpicture"+(current-1),
							
							style : "width: 100%; height: auto; display: none; left: 0px; top: 0px; position: absolute;",
						});

						var img_n2 = $(document.createElement('img'));
						img_n2.attr({
							src : dict[current-1].path_thumb,
							class : "bild",
							id : "bigpicture_thumb"+(current-1),
							style : "width: 100%; height: auto; display: inline-block; right: "+$(window).width()+"px; top: 0px; position: absolute;",
						});
						
						$(rightwrapper).append(img_n2);
						$(rightwrapper).append(img_n1);

							
							$(img_n1).one('load', function() {
							$(img_n2).animate({
								right : "0px",
							}, 500, function() {
								
								$(img_n2).css('display', 'none');
								$(img_n1).css('display', 'inline-block');
								console.log("removing #bigpicture"+(current)+"");
								$("#bigpicture"+(current+1)+"").remove();
								$("#bigpicture_thumb"+(current+1)+"").remove();
							});
							current--;
							
						}).each(function() {
							if (this.complete)
								$(this).load();
						});
							
							
						});

						$(back_button).click(function() {

							$(back_button).add(prev_button).add(next_button).animate({
								opacity : 0,

							}, 500, function() {
								$(this).css('display', 'none');
							});

							$("#masterwrapper").animate({
								marginLeft : "0px",
							}, 500, function() {
								$("#masterwrapper").css('width', "100%");
								$("#wrapper").css('width', "100%");
								$(rightwrapper).remove();
								$(rightwrapper).empty();
								resize();

							});
							
						});

						$(back_button).add(prev_button).add(next_button).mouseenter(function() {
							$(this).animate({
								opacity : 0.7,

							}, 0, function() {

							});
						});

						$(back_button).add(prev_button).add(next_button).mouseleave(function() {
							$(this).animate({
								opacity : 0.2,

							}, 0, function() {

							});
						});

						$('#masterwrapper').css('width', '200%');
						$('#wrapper').css('width', '50%');
						$('#masterwrapper').append(rightwrapper);

						var img = $(document.createElement('img'));
						img.attr({
							src : val.path,
							class : "bild_n",
							id : "bigpicture"+i,
							width : $(window).width(),
							style : "display: none;",
						});

						var img2 = $(document.createElement('img'));
						img2.attr({
							src : val.path_thumb,
							class : "bild_n",
							id : "bigpicture_thumb"+i,
							width : $(window).width(),

							style : "display: inline-block;",
						});

						$(rightwrapper).append(img2);
						$(rightwrapper).append(img);

						$(img).one('load', function() {
							$("#masterwrapper").animate({
								marginLeft : "-" + $(window).width(),
							}, 500, function() {
								$(back_button).add(prev_button).add(next_button).css('display', 'block');
								$(back_button).add(prev_button).add(next_button).css('opacity', '0');

								$(back_button).add(prev_button).add(next_button).animate({
									opacity : 0.2,

								}, 500, function() {

								});
								current = i;
								$(img2).css('display', 'none');
								$(img).css('display', 'inline-block');
							});
						}).each(function() {
							if (this.complete)
								$(this).load();
						});

					});

					pos[next % cols] = pos[next % cols] + dict[i].height + 10;

					m.append(k);

					n.html("<h2 style='border: 1px solid #555; padding: 8px; color: #555; font-size: 14px; line-height: 18px;'>" + val.title + "</h2><p style='color: #555'>Model: " + val.model + "</p>")
					k.append(n);

					var img_thumb = $(document.createElement('img'));
					img_thumb.attr({
						src : dict[i].path_thumb,
						height : dict[i].height,
						width : dict[i].width,
						class : "bild",
						style : "display: inline",
					});

					m.append(img_thumb);
					$("#wrapper").append(m);

					next = next_Row(pos);

				});
				var lowest = lowestCol(pos);

				for (var i = 0; i < pos.length; i++) {
					if (pos[i] != pos[lowest]) {
						var m = $(document.createElement('div'));

						m.attr({
							class : "tile",
							style : "position: absolute; top:" + (pos[i % cols] + 10 ) + "px;left:50%; margin-left:" + (-(124 * cols) + (i % cols) * 250) + "px; background-color: #555; width: 240px; height: " + (pos[lowest] - pos[i] - 10) + "px;",
						});
						$("#wrapper").append(m);
					}
				}

			}

			function next_Row(pos) {
				var ele = 0;
				for (var temp = 0; temp < pos.length; temp++) {
					if (pos[ele] > pos[temp]) {
						ele = temp;
					}
				}
				console.log("next row is:" + ele);
				return ele;
			}

			function lowestCol(pos) {
				var ele = 0;
				for (var temp = 0; temp < pos.length; temp++) {
					if (pos[ele] < pos[temp]) {
						ele = temp;

					}
				}
				console.log("lowest is:" + ele);
				return ele;
			}

		</script>

	</body>
</html>
